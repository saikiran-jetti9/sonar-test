//Getting triggered user info
def cause = currentBuild.getBuildCauses('hudson.model.Cause$UserIdCause')

pipeline {
  agent { label 'bmg-trigon-prod-wrk' }
  environment {
    GITCREDENTIALS=credentials('jenkins-sa')
  }
  stages {
    stage('Deploy') {
      steps {
        // Run deploy script
        sh "chmod +x ./jenkins_scripts/deploy_gcp.sh"
        sh "./jenkins_scripts/deploy_gcp.sh prod ${GITCREDENTIALS_USR} ${GITCREDENTIALS_PSW} '${cause.userId}'"
      }
    }
  }
}
